{% extends "base.html" %}

{% block content %}
<h1>Latest Trade Decisions</h1>
{% include "partials/_config_banner.html" %}

<div class="table-container">
<table>
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Action</th>
      <th>Shares</th>
      <th>Amount (USD)</th>
      <th>Reason</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody>
    {% for trade in trades %}
      {% for decision in trade.data %}
      {% set raw_ticker = decision.get('ticker', 'N/A') %}
      {% set ticker = raw_ticker.upper() if raw_ticker %}
      <tr>
        <td class="ticker-cell">
          {% if ticker and ticker != 'N/A' %}
            <a class="ticker-link" href="https://finance.yahoo.com/quote/{{ ticker }}/" target="_blank" rel="noopener noreferrer">
              {{ ticker }}
            </a>
            <button type="button" class="chart-button" data-ticker="{{ ticker }}" title="Open Yahoo Finance chart">
              Chart
            </button>
          {% else %}
            N/A
          {% endif %}
        </td>
        <td>{{ decision.get('action', 'N/A') }}</td>
        <td>
          {% if decision.get('shares') %}
            {{ '%.2f'|format(decision.get('shares')) }}
          {% else %}
            —
          {% endif %}
        </td>
        <td>
          {% if decision.get('total_value') %}
            ${{ '%.2f'|format(decision.get('total_value')) }}
          {% elif decision.get('amount_usd') %}
            ${{ '%.2f'|format(decision.get('amount_usd')) }}
          {% else %}
            —
          {% endif %}
        </td>
        <td>{{ decision.get('reason', 'N/A') }}</td>
        <td>{{ trade.timestamp }}</td>
      </tr>
      {% endfor %}
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script defer src="{{ url_for('static', filename='js/trades.js') }}"></script>
{% endblock %}
