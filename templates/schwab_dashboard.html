{% extends "base.html" %}

{% block content %}
<h1>Schwab Live Portfolio</h1>
{% include "partials/_config_banner.html" %}

<div id="connection-status" class="connection-status">
  <div class="status-indicator">
    <span id="status-icon">ğŸ”„</span>
    <span id="status-text">Checking connection...</span>
  </div>
  <button id="refresh-btn" class="refresh-btn" onclick="refreshSchwabData()">
    <span>ğŸ”„</span> Refresh
  </button>
</div>

<div id="account-meta" class="account-meta" style="display:none;">
  <div class="account-card">
    <span class="account-label">Account Hash</span>
    <span class="account-value" id="account-hash">--</span>
  </div>
  <div class="account-card">
    <span class="account-label">Account #</span>
    <span class="account-value" id="account-number">--</span>
  </div>
  <div class="account-card">
    <span class="account-label">Account Type</span>
    <span class="account-value" id="account-type">--</span>
  </div>
  <div class="account-card">
    <span class="account-label">Mode</span>
    <span class="account-value" id="account-mode">--</span>
  </div>
  <div class="account-card">
    <span class="account-label">Last Update</span>
    <span class="account-value" id="last-updated">--</span>
  </div>
</div>

<div id="readonly-note" class="readonly-note" style="display:none;">
  <strong>ğŸ”’ Schwab Read-Only Mode</strong>
  <p>No live orders will be submitted while this mode is active.</p>
</div>

<div id="schwab-summary" class="portfolio-summary" style="display: none;">
  <div class="metric-card">
    <h3>Total Portfolio Value</h3>
    <p id="total-value" class="value">$0.00</p>
  </div>
  <div class="metric-card">
    <h3>Funds Available</h3>
    <p id="funds-available" class="value">$0.00</p>
  </div>
  <div class="metric-card">
    <h3>Settled Cash Balance</h3>
    <p id="cash-balance" class="value">$0.00</p>
  </div>
  <div class="metric-card">
    <h3>Unsettled Cash</h3>
    <p id="unsettled-cash" class="value">$0.00</p>
  </div>
  <div class="metric-card">
    <h3>Order Reserve</h3>
    <p id="order-reserve" class="value">$0.00</p>
  </div>
  <div class="metric-card" id="funds-components-card" style="display:none;">
    <h3>Funds Breakdown</h3>
    <p id="funds-components" class="value" style="font-size:0.9rem; line-height:1.4;">â€”</p>
  </div>
  <div class="metric-card">
    <h3>Open Orders</h3>
    <p id="open-orders" class="value">0</p>
  </div>
  <div class="metric-card">
    <h3>Buying Power</h3>
    <p id="buying-power" class="value">$0.00</p>
  </div>
  <div class="metric-card">
    <h3>Day Trading Power</h3>
    <p id="day-trading-power" class="value">$0.00</p>
  </div>
</div>

<div id="holdings-section" style="display: none;">
  <h2>Current Holdings</h2>
  <div class="table-container">
    <table id="holdings-table" class="holdings-table">
      <thead>
        <tr>
          <th>Symbol</th>
          <th>Shares</th>
          <th>Avg Price</th>
          <th>Current Price</th>
          <th>Market Value</th>
          <th>Total Cost</th>
          <th>Gain/Loss</th>
          <th>Gain/Loss %</th>
        </tr>
      </thead>
      <tbody id="holdings-body"></tbody>
    </table>
  </div>
</div>

<div id="error-section" class="error-section" style="display: none;">
  <h3>âš ï¸ Connection Error</h3>
  <p id="error-message"></p>
  <div class="error-actions">
    <button onclick="refreshSchwabData()" class="retry-btn">ğŸ”„ Retry</button>
  </div>
</div>

<div id="simulation-warning" class="warning-section" style="display: none;">
  <h3>â„¹ï¸ Simulation Mode</h3>
  <p>Schwab API is configured but system is in simulation mode. Live trading is disabled.</p>
  <p>To enable live trading, set <code>TRADING_MODE=live</code> in your environment variables.</p>
</div>
{% endblock %}

{% block scripts %}
<script defer src="{{ url_for('static', filename='js/schwab.js') }}"></script>
{% endblock %}
